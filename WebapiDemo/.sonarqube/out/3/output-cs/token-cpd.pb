”
6E:\CX\WebapiDemo\WebApiDemo.BLL\Interfaces\IPostBll.cs
	namespace 	

WebApiDemo
 
. 
BLL 
. 

Interfaces #
{ 
public 

	interface 
IPostBll 
{ 
List 
< 
Post 
? 
> 
? 
GetAllPosts  
(  !
int! $
	sectionId% .
). /
;/ 0
List		 
<		 

UserBModel		 
?		 
>		 
?		 
GetAllUsers		 &
(		& '
int		' *
	sectionId		+ 4
)		4 5
;		5 6
List 
< 
Post 
? 
> 
? 
GetPosts 
( 
PostListBModel ,
postListBModel- ;
); <
;< =
List 
< 
Post 
? 
> 
? 
GetPosts 
( 
int !
	sectionId" +
,+ ,
int- 0

mainPostId1 ;
); <
;< =
int 
AddPost 
( 
int 
	sectionId !
,! "
Post" &
post' +
)+ ,
;, -
List 
< 

UserBModel 
? 
> 
? 
GetUsers #
(# $
PostListBModel$ 2
postListBModel3 A
)A B
;B C
Post 
? 
GetLastReplyPosts 
(  
int  #
	sectionId$ -
,- .
int/ 2

mainPostId3 =
)= >
;> ?
void 
UpVote 
( 
int 
	sectionId !
,! "
int" %
postId& ,
), -
;- .
void 
DownVote 
( 
int 
	sectionId #
,# $
int$ '
postId( .
). /
;/ 0
void 

UpdateView 
( 
int 
	sectionId %
,% &
int' *
postId+ 1
)1 2
;2 3
} 
} ‡
9E:\CX\WebapiDemo\WebApiDemo.BLL\Interfaces\ISectionBll.cs
	namespace 	

WebApiDemo
 
. 
BLL 
. 

Interfaces #
{ 
public 

	interface 
ISectionBll  
{ 
List		 
<		 
Section		 
>		 
?		 
GetAllSections		 %
(		% &
)		& '
;		' (
Section 
? 
GetSectionById 
(  
int  #
id$ &
)& '
;' (
List 
< 
Section 
> 
? 
GetSectionsByIds '
(' (
List( ,
<, -
int- 0
>0 1
ids2 5
)5 6
;6 7
List 
< 
Post 
> 
? 
GetMainPosts  
(  !
int! $
	sectionId% .
). /
;/ 0
} 
} ï
6E:\CX\WebapiDemo\WebApiDemo.BLL\Interfaces\IUserBll.cs
	namespace 	

WebApiDemo
 
. 
BLL 
. 

Interfaces #
{ 
public 

	interface 
IUserBll 
{ 
List 
< 

UserBModel 
? 
> 
? 
DebugGetAllUsers +
(+ ,
), -
;- .

UserBModel

 
?

 
DebugGetUserById

 $
(

$ %
int

% (
id

) +
)

+ ,
;

, -

UserBModel 
? 
GetUserById 
(  
int  #
id$ &
)& '
;' (

UserBModel 
? 
GetUserByIdForPost &
(& '
int' *
id+ -
)- .
;. /
string 
GetUserNameById 
( 
int "
id# %
)% &
;& '
List 
< 
string 
> 
GetUserNamesByIds &
(& '
List' +
<+ ,
int, /
>/ 0
ids1 4
)4 5
;5 6
bool 
CheckUserExist 
( 
string "
userName# +
)+ ,
;, -
int 

CheckLogin 
( 
string 
userName &
,& '
string( .
password/ 7
)7 8
;8 9
string "
GenerateAutoLoginToken %
(% &
int& )
userId* 0
)0 1
;1 2
int 
CheckAutoLoginToken 
(  
string  &
token' ,
), -
;- .
int 
AddUser 
( 

UserBModel 

userBModel )
)) *
;* +
string 

UpdateUser 
( 

UserBModel $

userBModel% /
)/ 0
;0 1
string   

RemoveUser   
(   
int   
id    
)    !
;  ! "

UserBModel"" 
?"" 
GetUserBaseInfoById"" '
(""' (
int""( +
id"", .
)"". /
;""/ 0

UserBModel$$ 
?$$ !
GetUserDetailInfoById$$ )
($$) *
int$$* -
id$$. 0
)$$0 1
;$$1 2
}%% 
}&& È€
*E:\CX\WebapiDemo\WebApiDemo.BLL\PostBll.cs
	namespace 	

WebApiDemo
 
. 
BLL 
{ 
public		 

class		 
PostBll		 
:		 
IPostBll		 #
{

 
private 
readonly 
IPostDalFactory (
_postDalFactory) 8
;8 9
public 
PostBll 
( 
IPostDalFactory &
postDalFactory' 5
)5 6
{ 	
_postDalFactory 
= 
postDalFactory ,
;, -
} 	
public 
List 
< 
Post 
? 
> 
? 
GetAllPosts '
(' (
int( +
	sectionId, 5
)5 6
{ 	
string 
? 
	tableName 
= 

SectionDal  *
.* +
GetSectionById+ 9
(9 :
	sectionId: C
)C D
?D E
.E F
	TableNameF O
;O P
if 
( 
	tableName 
== 
null !
)! "
{ 
return 
null 
; 
} 
return 
_postDalFactory "
." #

GetPostDal# -
(- .
	tableName. 7
)7 8
.8 9
GetAllPosts9 D
(D E
)E F
;F G
} 	
public 
List 
< 

UserBModel 
? 
>  
?  !
GetAllUsers" -
(- .
int. 1
	sectionId2 ;
); <
{ 	
string 
? 
	tableName 
= 

SectionDal  *
.* +
GetSectionById+ 9
(9 :
	sectionId: C
)C D
?D E
.E F
	TableNameF O
;O P
if 
( 
	tableName 
== 
null !
)! "
{   
return!! 
null!! 
;!! 
}"" 
List## 
<## 

UserBModel## 
?## 
>## 
?## 
users## $
=##% &
_postDalFactory##' 6
.##6 7

GetPostDal##7 A
(##A B
	tableName##B K
)##K L
.##L M
GetAllUsers##M X
(##X Y
)##Y Z
;##Z [
if%% 
(%% 
users%% 
==%% 
null%% 
)%% 
{&& 
return'' 
null'' 
;'' 
}(( 
List** 
<** 

UserBModel** 
?** 
>** 
?** 
result** %
=**& '
new**( +
(**+ ,
)**, -
;**- .
foreach++ 
(++ 

UserBModel++ 
?++  
user++! %
in++& (
users++) .
)++. /
{,, 
if-- 
(-- 
user-- 
==-- 
null--  
)--  !
{.. 
continue// 
;// 
}00 
result11 
.11 
Add11 
(11 
new22 

UserBModel22 "
{33 
Id44 
=44 
user44 !
.44! "
Id44" $
,44$ %
UserName55  
=55! "
user55# '
.55' (
UserName55( 0
,550 1
RegisterTime66 $
=66% &
user66' +
.66+ ,
RegisterTime66, 8
,668 9
Points77 
=77  
user77! %
.77% &
Points77& ,
}88 
)99 
;99 
}:: 
return<< 
result<< 
;<< 
}== 	
public?? 
List?? 
<?? 
Post?? 
??? 
>?? 
??? 
GetPosts?? $
(??$ %
PostListBModel??% 3
postListBModel??4 B
)??B C
{@@ 	
stringAA 
?AA 
	tableNameAA 
=AA 

SectionDalAA  *
.AA* +
GetSectionByIdAA+ 9
(AA9 :
postListBModelAA: H
.AAH I
	SectionIdAAI R
)AAR S
?AAS T
.AAT U
	TableNameAAU ^
;AA^ _
ifBB 
(BB 
	tableNameBB 
==BB 
nullBB !
)BB! "
{CC 
returnDD 
nullDD 
;DD 
}EE 
returnFF 
_postDalFactoryFF "
.GG 

GetPostDalGG 
(GG 
	tableNameGG %
)GG% &
.HH 
GetPostsHH 
(HH 
postListBModelHH (
.HH( )
BeginNumHH) 1
,HH1 2
postListBModelHH3 A
.HHA B
NeedNumHHB I
)HHI J
;HHJ K
}II 	
publicKK 
ListKK 
<KK 
PostKK 
?KK 
>KK 
?KK 
GetPostsKK $
(KK$ %
intKK% (
	sectionIdKK) 2
,KK2 3
intKK4 7

mainPostIdKK8 B
)KKB C
{LL 	
stringMM 
?MM 
	tableNameMM 
=MM 

SectionDalMM  *
.MM* +
GetSectionByIdMM+ 9
(MM9 :
	sectionIdMM: C
)MMC D
?MMD E
.MME F
	TableNameMMF O
;MMO P
ifNN 
(NN 
	tableNameNN 
==NN 
nullNN !
)NN! "
{OO 
returnPP 
nullPP 
;PP 
}QQ 
returnRR 
_postDalFactoryRR "
.RR" #

GetPostDalRR# -
(RR- .
	tableNameRR. 7
)RR7 8
.RR8 9
GetPostsRR9 A
(RRA B

mainPostIdRRB L
)RRL M
;RRM N
}SS 	
publicUU 
intUU 
AddPostUU 
(UU 
intUU 
	sectionIdUU (
,UU( )
PostUU* .
postUU/ 3
)UU3 4
{VV 	
stringWW 
?WW 
	tableNameWW 
=WW 

SectionDalWW  *
.WW* +
GetSectionByIdWW+ 9
(WW9 :
	sectionIdWW: C
)WWC D
?WWD E
.WWE F
	TableNameWWF O
;WWO P
ifXX 
(XX 
	tableNameXX 
==XX 
nullXX !
)XX! "
{YY 
returnZZ 
-ZZ 
$numZZ 
;ZZ 
}[[ 
int\\ 
id\\ 
=\\ 
_postDalFactory\\ #
.\\# $

GetPostDal\\$ .
(\\. /
	tableName\\/ 8
)\\8 9
.\\9 :
AddPost\\: A
(\\A B
post\\B F
)\\F G
;\\G H
Post]] 
?]] 
mainPost]] 
=]] 
_postDalFactory]] ,
.^^ 

GetPostDal^^ 
(^^ 
	tableName^^ %
)^^% &
.__ 
GetPostById__ 
(__ 
post__ !
.__! "

MainPostId__" ,
)__, -
;__- .
if`` 
(`` 
mainPost`` 
!=`` 
null``  
)``  !
{aa 
mainPostbb 
.bb 
ReplyNumbb !
=bb" #
GetPostsbb$ ,
(bb, -
	sectionIdbb- 6
,bb6 7
postbb8 <
.bb< =

MainPostIdbb= G
)bbG H
?bbH I
.bbI J
CountbbJ O
-bbO P
$numbbP Q
??bbR T
$numbbU V
;bbV W
_postDalFactorycc 
.cc  

GetPostDalcc  *
(cc* +
	tableNamecc+ 4
)cc4 5
.cc5 6

UpdatePostcc6 @
(cc@ A
mainPostccA I
)ccI J
;ccJ K
}dd 
returnff 
idff 
;ff 
}gg 	
publicii 
Listii 
<ii 

UserBModelii 
?ii 
>ii  
?ii  !
GetUsersii" *
(ii* +
PostListBModelii+ 9
postListBModelii: H
)iiH I
{jj 	
stringkk 
?kk 
	tableNamekk 
=kk 

SectionDalkk  *
.kk* +
GetSectionByIdkk+ 9
(kk9 :
postListBModelkk: H
.kkH I
	SectionIdkkI R
)kkR S
?kkS T
.kkT U
	TableNamekkU ^
;kk^ _
ifll 
(ll 
	tableNamell 
==ll 
nullll !
)ll! "
{mm 
returnnn 
nullnn 
;nn 
}oo 
Listpp 
<pp 

UserBModelpp 
?pp 
>pp 
?pp 
userspp $
=pp% &
_postDalFactorypp' 6
.qq 

GetPostDalqq 
(qq 
	tableNameqq %
)qq% &
.rr 
GetUsersrr 
(rr 
postListBModelrr (
.rr( )
BeginNumrr) 1
,rr1 2
postListBModelrr3 A
.rrA B
NeedNumrrB I
)rrI J
;rrJ K
iftt 
(tt 
userstt 
==tt 
nulltt 
)tt 
{uu 
returnvv 
nullvv 
;vv 
}ww 
Listyy 
<yy 

UserBModelyy 
?yy 
>yy 
?yy 
resultyy %
=yy& '
newyy( +
(yy+ ,
)yy, -
;yy- .
foreachzz 
(zz 

UserBModelzz 
?zz  
userzz! %
inzz& (
userszz) .
)zz. /
{{{ 
if|| 
(|| 
user|| 
==|| 
null||  
)||  !
{}} 
continue~~ 
;~~ 
} 
result
€€ 
.
€€ 
Add
€€ 
(
€€ 
new
 

UserBModel
 "
{
‚‚ 
Id
ƒƒ 
=
ƒƒ 
user
ƒƒ !
.
ƒƒ! "
Id
ƒƒ" $
,
ƒƒ$ %
UserName
„„  
=
„„! "
user
„„# '
.
„„' (
UserName
„„( 0
,
„„0 1
RegisterTime
…… $
=
……% &
user
……' +
.
……+ ,
RegisterTime
……, 8
,
……8 9
Points
†† 
=
††  
user
††! %
.
††% &
Points
††& ,
}
‡‡ 
)
ˆˆ 
;
ˆˆ 
}
‰‰ 
return
‹‹ 
result
‹‹ 
;
‹‹ 
}
ŒŒ 	
public
ŽŽ 
Post
ŽŽ 
?
ŽŽ 
GetLastReplyPosts
ŽŽ &
(
ŽŽ& '
int
ŽŽ' *
	sectionId
ŽŽ+ 4
,
ŽŽ4 5
int
ŽŽ6 9

mainPostId
ŽŽ: D
)
ŽŽD E
{
 	
string
 
?
 
	tableName
 
=
 

SectionDal
  *
.
* +
GetSectionById
+ 9
(
9 :
	sectionId
: C
)
C D
?
D E
.
E F
	TableName
F O
;
O P
if
‘‘ 
(
‘‘ 
	tableName
‘‘ 
==
‘‘ 
null
‘‘ !
)
‘‘! "
{
’’ 
return
““ 
null
““ 
;
““ 
}
”” 
return
–– 
_postDalFactory
–– "
.
––" #

GetPostDal
––# -
(
––- .
	tableName
––. 7
)
––7 8
.
––8 9
GetLastReplyPosts
––9 J
(
––J K

mainPostId
––K U
)
––U V
;
––V W
}
—— 	
public
™™ 
void
™™ 
UpVote
™™ 
(
™™ 
int
™™ 
	sectionId
™™ (
,
™™( )
int
™™* -
postId
™™. 4
)
™™4 5
{
šš 	
string
›› 
?
›› 
	tableName
›› 
=
›› 

SectionDal
››  *
.
››* +
GetSectionById
››+ 9
(
››9 :
	sectionId
››: C
)
››C D
?
››D E
.
››E F
	TableName
››F O
;
››O P
if
œœ 
(
œœ 
	tableName
œœ 
==
œœ 
null
œœ !
)
œœ! "
{
 
return
žž 
;
žž 
}
ŸŸ 
Post
¡¡ 
?
¡¡ 
post
¡¡ 
=
¡¡ 
_postDalFactory
¡¡ (
.
¡¡( )

GetPostDal
¡¡) 3
(
¡¡3 4
	tableName
¡¡4 =
)
¡¡= >
.
¡¡> ?
GetPostById
¡¡? J
(
¡¡J K
postId
¡¡K Q
)
¡¡Q R
;
¡¡R S
if
¢¢ 
(
¢¢ 
post
¢¢ 
==
¢¢ 
null
¢¢ 
)
¢¢ 
{
££ 
return
¤¤ 
;
¤¤ 
}
¥¥ 
post
¦¦ 
.
¦¦ 
UpVote
¦¦ 
++
¦¦ 
;
¦¦ 
_postDalFactory
§§ 
.
§§ 

GetPostDal
§§ &
(
§§& '
	tableName
§§' 0
)
§§0 1
.
§§1 2

UpdatePost
§§2 <
(
§§< =
post
§§= A
)
§§A B
;
§§B C
}
¨¨ 	
public
ªª 
void
ªª 
DownVote
ªª 
(
ªª 
int
ªª  
	sectionId
ªª! *
,
ªª* +
int
ªª, /
postId
ªª0 6
)
ªª6 7
{
«« 	
string
¬¬ 
?
¬¬ 
	tableName
¬¬ 
=
¬¬ 

SectionDal
¬¬  *
.
¬¬* +
GetSectionById
¬¬+ 9
(
¬¬9 :
	sectionId
¬¬: C
)
¬¬C D
?
¬¬D E
.
¬¬E F
	TableName
¬¬F O
;
¬¬O P
if
­­ 
(
­­ 
	tableName
­­ 
==
­­ 
null
­­ !
)
­­! "
{
®® 
return
¯¯ 
;
¯¯ 
}
°° 
Post
²² 
?
²² 
post
²² 
=
²² 
_postDalFactory
²² (
.
²²( )

GetPostDal
²²) 3
(
²²3 4
	tableName
²²4 =
)
²²= >
.
²²> ?
GetPostById
²²? J
(
²²J K
postId
²²K Q
)
²²Q R
;
²²R S
if
³³ 
(
³³ 
post
³³ 
==
³³ 
null
³³ 
)
³³ 
{
´´ 
return
µµ 
;
µµ 
}
¶¶ 
post
·· 
.
·· 
DownVote
·· 
++
·· 
;
·· 
_postDalFactory
¸¸ 
.
¸¸ 

GetPostDal
¸¸ &
(
¸¸& '
	tableName
¸¸' 0
)
¸¸0 1
.
¸¸1 2

UpdatePost
¸¸2 <
(
¸¸< =
post
¸¸= A
)
¸¸A B
;
¸¸B C
}
¹¹ 	
public
»» 
void
»» 

UpdateView
»» 
(
»» 
int
»» "
	sectionId
»»# ,
,
»», -
int
»». 1
postId
»»2 8
)
»»8 9
{
¼¼ 	
string
½½ 
?
½½ 
	tableName
½½ 
=
½½ 

SectionDal
½½  *
.
½½* +
GetSectionById
½½+ 9
(
½½9 :
	sectionId
½½: C
)
½½C D
?
½½D E
.
½½E F
	TableName
½½F O
;
½½O P
if
¾¾ 
(
¾¾ 
	tableName
¾¾ 
==
¾¾ 
null
¾¾ !
)
¾¾! "
{
¿¿ 
return
ÀÀ 
;
ÀÀ 
}
ÁÁ 
Post
ÃÃ 
?
ÃÃ 
post
ÃÃ 
=
ÃÃ 
_postDalFactory
ÃÃ (
.
ÃÃ( )

GetPostDal
ÃÃ) 3
(
ÃÃ3 4
	tableName
ÃÃ4 =
)
ÃÃ= >
.
ÃÃ> ?
GetPostById
ÃÃ? J
(
ÃÃJ K
postId
ÃÃK Q
)
ÃÃQ R
;
ÃÃR S
if
ÄÄ 
(
ÄÄ 
post
ÄÄ 
==
ÄÄ 
null
ÄÄ 
)
ÄÄ 
{
ÅÅ 
return
ÆÆ 
;
ÆÆ 
}
ÇÇ 
post
ÈÈ 
.
ÈÈ 
ViewNum
ÈÈ 
++
ÈÈ 
;
ÈÈ 
_postDalFactory
ÉÉ 
.
ÉÉ 

GetPostDal
ÉÉ &
(
ÉÉ& '
	tableName
ÉÉ' 0
)
ÉÉ0 1
.
ÉÉ1 2

UpdatePost
ÉÉ2 <
(
ÉÉ< =
post
ÉÉ= A
)
ÉÉA B
;
ÉÉB C
}
ÊÊ 	
}
ËË 
}ÌÌ ¹
-E:\CX\WebapiDemo\WebApiDemo.BLL\SectionBll.cs
	namespace 	

WebApiDemo
 
. 
BLL 
{ 
public		 

class		 

SectionBll		 
:		 
ISectionBll		 )
{

 
private 
readonly 
IPostDalFactory (
_postDalFactory) 8
;8 9
public 

SectionBll 
( 
IPostDalFactory )
postDalFactory* 8
)8 9
{ 	
_postDalFactory 
= 
postDalFactory ,
;, -
} 	
public 
List 
< 
Section 
> 
? 
GetAllSections ,
(, -
)- .
{ 	
return 

SectionDal 
. 
GetAllSections ,
(, -
)- .
;. /
} 	
public 
List 
< 
Post 
> 
? 
GetMainPosts '
(' (
int( +
	sectionId, 5
)5 6
{ 	
string 
? 
	tableName 
= 

SectionDal  *
.* +
GetSectionById+ 9
(9 :
	sectionId: C
)C D
?D E
.E F
	TableNameF O
;O P
if 
( 
	tableName 
== 
null !
)! "
{ 
return 
null 
; 
} 
return 
_postDalFactory "
." #

GetPostDal# -
(- .
	tableName. 7
)7 8
.8 9
GetMainPosts9 E
(E F
)F G
;G H
} 	
public!! 
Section!! 
?!! 
GetSectionById!! &
(!!& '
int!!' *
id!!+ -
)!!- .
{"" 	
return## 

SectionDal## 
.## 
GetSectionById## ,
(##, -
id##- /
)##/ 0
;##0 1
}$$ 	
public&& 
List&& 
<&& 
Section&& 
>&& 
?&& 
GetSectionsByIds&& .
(&&. /
List&&/ 3
<&&3 4
int&&4 7
>&&7 8
ids&&9 <
)&&< =
{'' 	
List(( 
<(( 
Section(( 
>(( 
sections(( "
=((# $
new((% (
(((( )
)(() *
;((* +
foreach)) 
()) 
int)) 
id)) 
in)) 
ids)) "
)))" #
{** 
Section++ 
?++ 
section++  
=++! "
GetSectionById++# 1
(++1 2
id++2 4
)++4 5
;++5 6
if,, 
(,, 
section,, 
!=,, 
null,, #
),,# $
{-- 
sections.. 
... 
Add..  
(..  !
section..! (
)..( )
;..) *
}// 
}00 
return11 
sections11 
;11 
}22 	
}33 
}44 ‘Q
*E:\CX\WebapiDemo\WebApiDemo.BLL\UserBll.cs
	namespace 	

WebApiDemo
 
. 
BLL 
{ 
public		 

class		 
UserBll		 
:		 
IUserBll		 #
{

 
public 
List 
< 

UserBModel 
? 
>  
?  !
DebugGetAllUsers" 2
(2 3
)3 4
{ 	
return 
UserDal 
. 
DebugGetAllUsers +
(+ ,
), -
;- .
} 	
public 

UserBModel 
? 
DebugGetUserById +
(+ ,
int, /
id0 2
)2 3
{ 	
return 
UserDal 
. 
DebugGetUserById +
(+ ,
id, .
). /
;/ 0
} 	
public 

UserBModel 
? 
GetUserById &
(& '
int' *
id+ -
)- .
{ 	
return 
UserDal 
. 
GetUserById &
(& '
id' )
)) *
;* +
} 	
public 
string 
GetUserNameById %
(% &
int& )
id* ,
), -
{ 	

UserBModel 
? 
user 
= 
UserDal &
.& '
GetUserById' 2
(2 3
id3 5
)5 6
;6 7
if 
( 
user 
== 
null 
) 
{   
return!! 
$str!! 
;!! 
}"" 
return$$ 
user$$ 
.$$ 
UserName$$  
??$$! #
$str$$$ -
;$$- .
}%% 	
public'' 
List'' 
<'' 
string'' 
>'' 
GetUserNamesByIds'' -
(''- .
List''. 2
<''2 3
int''3 6
>''6 7
ids''8 ;
)''; <
{(( 	
List)) 
<)) 
string)) 
>)) 
	userNames)) "
=))# $
new))% (
())( )
)))) *
;))* +
foreach** 
(** 
int** 
id** 
in** 
ids** "
)**" #
{++ 
	userNames,, 
.,, 
Add,, 
(,, 
GetUserNameById,, -
(,,- .
id,,. 0
),,0 1
),,1 2
;,,2 3
}-- 
return// 
	userNames// 
;// 
}00 	
public22 

UserBModel22 
?22 
GetUserByIdForPost22 -
(22- .
int22. 1
id222 4
)224 5
{33 	

UserBModel55 
?55 
user55 
=55 
UserDal55 &
.55& '
GetUserById55' 2
(552 3
id553 5
)555 6
;556 7
if66 
(66 
user66 
==66 
null66 
)66 
{77 
return88 
null88 
;88 
}99 
return;; 
new;; 

UserBModel;; !
{<< 
UserName== 
=== 
user== 
.==  
UserName==  (
,==( )
RegisterTime>> 
=>> 
user>> #
.>># $
RegisterTime>>$ 0
,>>0 1
Points?? 
=?? 
user?? 
.?? 
Points?? $
}@@ 
;@@ 
}AA 	
publicCC 

UserBModelCC 
?CC 
GetUserBaseInfoByIdCC .
(CC. /
intCC/ 2
idCC3 5
)CC5 6
{DD 	

UserBModelEE 
?EE 
userEE 
=EE 
UserDalEE &
.EE& '
GetUserByIdEE' 2
(EE2 3
idEE3 5
)EE5 6
;EE6 7
ifFF 
(FF 
userFF 
==FF 
nullFF 
)FF 
{GG 
returnHH 
nullHH 
;HH 
}II 
returnKK 
newKK 

UserBModelKK !
{LL 
IdMM 
=MM 
userMM 
.MM 
IdMM 
,MM 
UserNameNN 
=NN 
userNN 
.NN  
UserNameNN  (
,NN( )
RegisterTimeOO 
=OO 
userOO #
.OO# $
RegisterTimeOO$ 0
,OO0 1
PointsPP 
=PP 
userPP 
.PP 
PointsPP $
}QQ 
;QQ 
}RR 	
publicTT 

UserBModelTT 
?TT !
GetUserDetailInfoByIdTT 0
(TT0 1
intTT1 4
idTT5 7
)TT7 8
{UU 	
returnVV 
UserDalVV 
.VV 
GetUserByIdVV &
(VV& '
idVV' )
)VV) *
;VV* +
}WW 	
publicYY 
boolYY 
CheckUserExistYY "
(YY" #
stringYY# )
userNameYY* 2
)YY2 3
{ZZ 	
return[[ 
UserDal[[ 
.[[ 
CheckUserExist[[ )
([[) *
userName[[* 2
)[[2 3
;[[3 4
}\\ 	
public^^ 
int^^ 

CheckLogin^^ 
(^^ 
string^^ $
userName^^% -
,^^- .
string^^/ 5
password^^6 >
)^^> ?
{__ 	
password`` 
=`` 
password`` 
.``  
ToMd5``  %
(``% &
)``& '
;``' (
Listaa 
<aa 

UserBModelaa 
?aa 
>aa 
?aa 
userListaa '
=aa( )
UserDalaa* 1
.aa1 2(
GetUserByUserNameAndPasswordaa2 N
(aaN O
userNameaaO W
,aaW X
passwordaaY a
)aaa b
;aab c
ifbb 
(bb 
userListbb 
?bb 
.bb 
Countbb 
<=bb  "
$numbb# $
||bb% '
userListbb( 0
==bb1 3
nullbb4 8
)bb8 9
{cc 
returndd 
-dd 
$numdd 
;dd 
}ee 

UserBModelhh 
?hh 
userhh 
=hh 
userListhh '
.hh' (
Findhh( ,
(hh, -
userhh- 1
=>hh2 4
userhh5 9
?hh9 :
.hh: ;
	IsDeletedhh; D
==hhE G
falsehhH M
)hhM N
;hhN O
ifjj 
(jj 
userjj 
==jj 
nulljj 
)jj 
{kk 
returnll 
-ll 
$numll 
;ll 
}mm 
UserDaloo 
.oo 
UpdateLastLoginTimeoo '
(oo' (
useroo( ,
.oo, -
Idoo- /
)oo/ 0
;oo0 1
returnpp 
userpp 
.pp 
Idpp 
;pp 
}qq 	
publicss 
stringss "
GenerateAutoLoginTokenss ,
(ss, -
intss- 0
userIdss1 7
)ss7 8
{tt 	
returnuu 
UserDaluu 
.uu "
GenerateAutoLoginTokenuu 1
(uu1 2
userIduu2 8
)uu8 9
;uu9 :
}vv 	
publicxx 
intxx 
CheckAutoLoginTokenxx &
(xx& '
stringxx' -
tokenxx. 3
)xx3 4
{yy 	
intzz 
userIdzz 
=zz 
UserDalzz  
.zz  !
CheckAutoLoginTokenzz! 4
(zz4 5
tokenzz5 :
)zz: ;
;zz; <
if{{ 
({{ 
userId{{ 
>{{ 
$num{{ 
){{ 
{|| 
UserDal}} 
.}} 
UpdateLastLoginTime}} +
(}}+ ,
userId}}, 2
)}}2 3
;}}3 4
}~~ 
return 
userId 
; 
}
€€ 	
public
‚‚ 
int
‚‚ 
AddUser
‚‚ 
(
‚‚ 

UserBModel
‚‚ %

userBModel
‚‚& 0
)
‚‚0 1
{
ƒƒ 	
if
„„ 
(
„„ 

userBModel
„„ 
.
„„ 
Password
„„ #
==
„„$ &
null
„„' +
)
„„+ ,
{
…… 
return
†† 
-
†† 
$num
†† 
;
†† 
}
‡‡ 

userBModel
‰‰ 
.
‰‰ 
Password
‰‰ 
=
‰‰  !

userBModel
‰‰" ,
.
‰‰, -
Password
‰‰- 5
.
‰‰5 6
ToMd5
‰‰6 ;
(
‰‰; <
)
‰‰< =
;
‰‰= >
return
ŠŠ 
UserDal
ŠŠ 
.
ŠŠ 
AddUser
ŠŠ "
(
ŠŠ" #

userBModel
ŠŠ# -
)
ŠŠ- .
;
ŠŠ. /
}
‹‹ 	
public
 
string
 

UpdateUser
  
(
  !

UserBModel
! +

userBModel
, 6
)
6 7
{
ŽŽ 	
if
 
(
 

userBModel
 
.
 
Password
 #
!=
$ &
null
' +
)
+ ,
{
 

userBModel
‘‘ 
.
‘‘ 
Password
‘‘ #
=
‘‘$ %

userBModel
‘‘& 0
.
‘‘0 1
Password
‘‘1 9
.
‘‘9 :
ToMd5
‘‘: ?
(
‘‘? @
)
‘‘@ A
;
‘‘A B
}
’’ 
return
““ 
UserDal
““ 
.
““ 

UpdateUser
““ %
(
““% &

userBModel
““& 0
)
““0 1
>
““2 3
$num
““4 5
?
““6 7
$str
““8 >
:
““? @
$str
““A G
;
““G H
}
”” 	
public
–– 
string
–– 

RemoveUser
––  
(
––  !
int
––! $
id
––% '
)
––' (
{
—— 	
return
˜˜ 
UserDal
˜˜ 
.
˜˜ 

RemoveUser
˜˜ %
(
˜˜% &
id
˜˜& (
)
˜˜( )
>
˜˜* +
$num
˜˜, -
?
˜˜. /
$str
˜˜0 6
:
˜˜7 8
$str
˜˜9 ?
;
˜˜? @
}
™™ 	
}
šš 
}›› 